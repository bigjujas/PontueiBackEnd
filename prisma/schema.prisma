generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id                     String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String    @db.VarChar(100)
  email                  String    @unique @db.VarChar(100)
  password_hash          String    @db.VarChar(255)
  cpf                    String    @unique @db.VarChar(14)
  date_of_birth          DateTime? @db.Date
  points_balance         Int?      @default(0)
  is_establishment_owner Boolean?  @default(false)
  created_at             DateTime? @default(now()) @db.Timestamptz(6)
  updated_at             DateTime? @default(now()) @updatedAt @db.Timestamptz(6)

  // Relations
  establishment          Establishment?
  orders                 Order[]
  payments               Payment[]
  points_transactions    PointsTransaction[]

  @@map("clients")
}

model Establishment {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  owner_client_id String    @unique @db.Uuid
  name            String    @db.VarChar(100)
  category        String    @db.VarChar(50)
  description     String?
  address         String    @db.VarChar(255)
  logo_url        String?   @db.VarChar(255)
  cover_url       String?   @db.VarChar(255)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @updatedAt @db.Timestamptz(6)

  // Relations
  owner           Client     @relation(fields: [owner_client_id], references: [id], onDelete: Cascade)
  products        Product[]
  orders          Order[]

  @@map("establishments")
}

model Product {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  establishment_id String    @db.Uuid
  name             String    @db.VarChar(100)
  description      String?
  price            Decimal   @db.Decimal(10, 2)
  photo_url        String?   @db.VarChar(255)
  is_active        Boolean?  @default(true)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @updatedAt @db.Timestamptz(6)

  // Relations
  establishment    Establishment @relation(fields: [establishment_id], references: [id], onDelete: Cascade)
  order_items      OrderItem[]

  @@map("products")
}

model Order {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id        String    @db.Uuid
  establishment_id String    @db.Uuid
  status           String    @default("pending") @db.VarChar(50)
  total_amount     Decimal   @db.Decimal(10, 2)
  points_generated Int
  pickup_type      String    @default("now") @db.VarChar(20)
  pickup_qr_code   String?   @unique @db.VarChar(255)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @updatedAt @db.Timestamptz(6)

  // Relations
  client           Client      @relation(fields: [client_id], references: [id])
  establishment    Establishment @relation(fields: [establishment_id], references: [id])
  order_items      OrderItem[]
  payments         Payment[]
  points_transactions PointsTransaction[]

  @@map("orders")
}

model OrderItem {
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id   String  @db.Uuid
  product_id String  @db.Uuid
  quantity   Int
  unit_price Decimal @db.Decimal(10, 2)

  // Relations
  order      Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product    Product @relation(fields: [product_id], references: [id])

  @@map("order_items")
}

model Payment {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id       String    @db.Uuid
  client_id      String    @db.Uuid
  amount         Decimal   @db.Decimal(10, 2)
  payment_method String    @db.VarChar(50)
  status         String    @db.VarChar(50)
  transaction_id String    @unique @db.VarChar(255)
  created_at     DateTime? @default(now()) @db.Timestamptz(6)

  // Relations
  order          Order     @relation(fields: [order_id], references: [id], onDelete: Cascade)
  client         Client    @relation(fields: [client_id], references: [id])

  @@map("payments")
}

model PointsTransaction {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id   String    @db.Uuid
  order_id    String?   @db.Uuid
  points      Int
  type        String    @db.VarChar(20)
  description String?   @db.VarChar(255)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)

  // Relations
  client      Client    @relation(fields: [client_id], references: [id])
  order       Order?    @relation(fields: [order_id], references: [id])

  @@map("points_transactions")
}

// Enums removidos pois o banco usa VARCHAR para esses campos
